<!DOCTYPE html>
<html>

<head>
	<title>Use Dynamic Web TWAIN to read Barcode</title>
	<script src="Resources/dynamsoft.webtwain.initiate.js"> </script>
	<script src="Resources/dynamsoft.webtwain.config.js"> </script>
	<script src="Resources/addon/dynamsoft.webtwain.addon.barcodereader.js"> </script>
	<link rel="stylesheet" href="Style/ds.demo.css">
</head>

<body>
	<div id="header">
		<span onclick="this.parentElement.style.display='none'" class="close">&times;</span>
		<div class="container">
			<div id="headerTop" class="row">
				<div class="ct-lt fl clearfix">
					<div class="logo mr20 fl">
						<img src="Style/Images/logo-dwt-56x56.png" alt="Logo"> </div>
					<div class="fl">
						<div class="linkGroup">
							<a target="_blank" class="bluelink" href="http://www.dynamsoft.com">Dynamsoft</a>
							<span> / </span>
							<a target="_blank" class="bluelink" href="http://www.dynamsoft.com/Products/WebTWAIN_Overview.aspx">Dynamic Web TWAIN</a>
							<span> / </span>
							<a target="_blank" class="bluelink" href="http://www.dynamsoft.com/Downloads/WebTWAIN-Sample-Download.aspx">Code Gallery</a>
						</div>
						<h1>Acquire Images from Scanners and Read Barcode</h1>
					</div>
				</div>
				<div class="ct-rt fr">
					<a target="_blank" href="http://www.dynamsoft.com/Downloads/WebTWAIN_Download.aspx" class="btn lgBtn bgOrange">Download SDK</a>
				</div>
			</div>
			<div id="headerBtm" class="row"> The demo demonstrates how to use Dynamic Web TWAIN to acquire images and read barcode on them. </div>
		</div>
	</div>

	<!--The Key Part of the Sample Starts Here-->
	<div id="main">
		<div class="container">
			<div class="ct-lt clearfix">
				<!-- dwtcontrolContainer is the default div id for Dynamic Web TWAIN control.
				 If you need to rename the id, you should also change the id in the dynamsoft.webtwain.config.js accordingly. -->
				<div id="dwtcontrolContainer"></div>
			</div>
			<div class="ct-rt">
				<div class="content clearfix">
					<div class="section">
                        <input multiple accept="image/jpeg,image/png,image/tiff" id="fileTest" style="display:none"type="file" onchange="btnLoadFromLocalFile(this)" />
						<input id="btnDownloadImage" type="button" class="btn bgBlue mr4p w47p" value="Download An Image" onclick="DownloadImage();" />
						<input type="button" class="btn bgBlue w47p" value="Load An Image" onclick="LoadImage();" />
						<div id="divScan" style="display:none;">
                            <select class="w100p mt20" id="source"></select>
						    <br />
						    <input type="button" class="btn bgBlue mt20  w47p" value="Scan An Image" onclick="AcquireImage();" />
                        </div>
					</div>
					<div class="section">
						<select id="barcodeformat" class="w100p"></select>
						<div style="margin-top: 10px;">
						<label for="radSpeed"><input type="radio" id="radSpeed" value="speed" name="ReaderMode">Speed </label>
						<label for="radBalance" style="margin-left:15px;"><input type="radio" id="radBalance" value="balance" name="ReaderMode">Balance</label>
						<label for="radCoverage" style="margin-left:15px;"><input type="radio" id="radCoverage" value="coverage" name="ReaderMode">Coverage</label>
						</div>
						<input type="button" class="btn bgBlue mt20 w47p" value="Read Barcode" onclick="ReadBarcode();" />
					</div>
					<div id="DWTcontainerBtm" class="section">
						<p>Result:</p>
						<div id="divNoteMessage"> </div>
					</div>
				</div>
			</div>
		</div>
	</div>
	<!--The Key Part of the Sample Ends Here-->
	<div id="footer">
		<span onclick="this.parentElement.style.display='none'" class="close">&times;</span>
		<div class="container">
			<div id="footerTop" class="row">
				<div class="item contact">
					<strong class="fc4">Contact Us</strong>
					<ul>
						<li>
							<a class="graylink" href="mailto:support@dynamsoft.com">support@dynamsoft.com</a>
						</li>
						<li>
							<a target="_blank" class="graylink" href="http://www.dynamsoft.com/Support/LiveHelp.aspx">Live Chat</a> /
							<a target="_blank" class="graylink" href="http://www.dynamsoft.com/Support/LiveHelp.aspx">Submit a Form</a>
						</li>
						<li>1-604-605-5491 (Toll-Free)</li>
					</ul>
				</div>
				<div class="item features">
					<strong class="fc4">Features Demonstrated</strong>
					<ul class="org-li">
						<li>Scan documents from Scanners</li>
						<li>Load or Download Images</li>
						<li>Read Barcode from Images in buffer</li>
					</ul>
				</div>
				<div class="item license">
					<strong class="fc4">License Required</strong>
					<ul class="org-li">
						<li>Core SDK licenses (HTML5 License for Windows)</li>
						<li>Add-on license for Barcode Reader (1D, PDF417, DATAMATRIX, QR_CODE, Aztec Code, etc.)</li>
						<li>
							<a class="bluelink ds-demo-font-size-14" href="mailto:sales@dynamsoft.com">Contact Dynamsoft Sales</a>&nbsp;
							<span class="fcBlue"> | </span>&nbsp;
							<a target="_blank" class="bluelink ds-demo-font-size-14" href="https://www.dynamsoft.com/Secure/WebTWAIN_BuyIt.aspx">Visit Online Store</a>
						</li>
					</ul>
				</div>
			</div>
			<div id="footerBtm" class="row">
				<div class="ct-lt tc fl">&copy; 2003 -
					<script>document.write((new Date()).getFullYear());</script> Dynamsoft. All rights reserved.
					<a href="http://www.dynamsoft.com/PrivacyStatement.aspx">Privacy Statement</a> /
					<a href="http://www.dynamsoft.com/SiteMap.html">Site Map</a>
				</div>
				<div class="ct-rt tr fr">
					<a href="http://www.dynamsoft.com/">Home</a> /
					<a href="http://www.dynamsoft.com/Purchase/Purchase.aspx">Purchase</a> /
					<a href="http://www.dynamsoft.com/Support/Support.aspx">Support</a>
				</div>
			</div>
		</div>
	</div>

	<script type="text/javascript">
		window.onload = function () {
			if (Dynamsoft) {
				Dynamsoft.WebTwainEnv.Load();

				var p = document.location.protocol;
				if (p !== 'https:' && p !== 'http:') {
					document.getElementById("btnDownloadImage").style.display = "none";
				}

				var vBalance = document.getElementById("radBalance");
				if (vBalance)
				    vBalance.checked = true;
			}
		};
		Dynamsoft.WebTwainEnv.AutoLoad = false;
		Dynamsoft.WebTwainEnv.RegisterEvent('OnWebTwainReady', Dynamsoft_OnReady); // Register OnWebTwainReady event. This event fires as soon as Dynamic Web TWAIN is initialized and ready to be used

		var DWObject, barcodeText = [];
		var CurrentPathName = unescape(location.pathname);
		var CurrentPath = CurrentPathName.substring(0, CurrentPathName.lastIndexOf("/") + 1);
		var strHTTPServer = location.hostname;

		var BarcodeInfo =
			[
				{ desc: "All", val: -32505857, bf: 1 },
				{ desc: "1D Barcodes", val: 2047, bf: 1 },
				{ desc: "QR Code", val: 67108864, bf: 1 },
				{ desc: "PDF417", val: 33554432, bf: 1 },
				{ desc: "DATAMATRIX", val: 134217728, bf: 1 },
				{ desc: "Aztec Code", val: 268435456, bf: 1 },
				{ desc: "GS1 Databar", val: 260096, bf: 1 },
				{ desc: "Maxicode", val: 536870912, bf: 1 },
				{ desc: "Patch Code", val: 262144, bf: 1 },
				{ desc: "GS1 COMPOSITE", val: -2147483648, bf: 1 },
				{ desc: "Postal Code", val: 32505856, bf: 2 },
				{ desc: "DotCode", val: 2, bf: 2 },
				{ desc: "CODE_39", val: 1, bf: 1 },
				{ desc: "CODE_128", val: 2, bf: 1 },
				{ desc: "CODE_93", val: 4, bf: 1 },
				{ desc: "CODABAR", val: 8, bf: 1 },
				{ desc: "EAN_13", val: 32, bf: 1 },
				{ desc: "EAN_8", val: 64, bf: 1 },
				{ desc: "UPC_A", val: 128, bf: 1 },
				{ desc: "UPC_E", val: 256, bf: 1 },
				{ desc: "Interleaved 2 of 5", val: 16, bf: 1 },
				{ desc: "Industrial 2 of 5", val: 512, bf: 1 },
				{ desc: "CODE 39 EXTENDED", val: 1024, bf: 1 }
			];

		function Dynamsoft_OnReady() {
			DWObject = Dynamsoft.WebTwainEnv.GetWebTwain('dwtcontrolContainer'); // Get the Dynamic Web TWAIN object that is embeded in the div with id 'dwtcontrolContainer'
			if (DWObject) {
				DWObject.Width = 504;
				DWObject.Height = 599;
				DWObject.RegisterEvent('OnTopImageInTheViewChanged', function (index) {
					DWObject.CurrentImageIndexInBuffer = index;
				});
				var divScan = document.getElementById('divScan');
				if (DWObject._isMobileMode()) {
				    divScan.style.display = "none";

				} else {
				    divScan.style.display = "";
				    document.getElementById('source').options.length = 0;
				    var count = DWObject.SourceCount;
				    for (var i = 0; i < count; i++) {
				        document.getElementById('source').options.add(new Option(DWObject.GetSourceNameItems(i), i));
				    }
				}
				for (var index = 0; index < BarcodeInfo.length; index++)
					document.getElementById("barcodeformat").options.add(new Option(BarcodeInfo[index].desc, index));
				DWObject.IfSSL = Dynamsoft.Lib.detect.ssl;
				var _strPort = location.port == "" ? 80 : location.port;
				if (Dynamsoft.Lib.detect.ssl == true)
					_strPort = location.port == "" ? 443 : location.port;
				DWObject.HTTPPort = _strPort;
			}
		}

		function AcquireImage() {
			if (DWObject) {
				var bSelected = DWObject.SelectSourceByIndex(document.getElementById('source').selectedIndex);
				if (bSelected) {
					var OnAcquireImageSuccess, OnAcquireImageFailure;
					OnAcquireImageSuccess = OnAcquireImageFailure = function () {
						DWObject.CloseSource();
					};

					DWObject.OpenSource();
					DWObject.IfDisableSourceAfterAcquire = true; // Scanner source will be disabled/closed automatically after the scan. 
					DWObject.AcquireImage(OnAcquireImageSuccess, OnAcquireImageFailure);
				}
			}
		}

		//Callback functions for async APIs
		function OnSuccess() {
			console.log('successful');
		}

		function OnFailure(errorCode, errorString) {
			alert(errorString);
		}

		function LoadImage() {
		    if (DWObject) {
		        if (DWObject._isMobileMode()) {
		            var vdwtmobilefile = document.getElementById("fileTest");
		            vdwtmobilefile.value = '';
		            vdwtmobilefile.click();
		        } else {
		            DWObject.IfShowFileDialog = true; // Open the system's file dialog to load image
		            DWObject.LoadImageEx("", EnumDWT_ImageType.IT_ALL, OnSuccess, OnFailure); // Load images in all supported formats (.bmp, .jpg, .tif, .png, .pdf). OnSuccess or OnFailure will be called after the operation
		        }
		    }
		}

		function btnLoadFromLocalFile(_this) {
		    for (var index = 0; index < _this.files.length; index++) {
		        DWObject.LoadImageFromBinary(_this.files[index]);
		    }

		    _this.files.length = 0;
		    var inputFile1 = document.getElementById("fileTest");
		    inputFile1.value = '';
		}

		function DownloadImage() {
			if (DWObject) {
				DWObject.HTTPDownload(strHTTPServer, CurrentPath + "BarcodeImages/AllSupportedBarcodeTypes.tif");
			}
		}

		function GetBacodeFormatDesc(format) {
			for (var index = 0; index < BarcodeInfo.length; index++) {
				if (BarcodeInfo[index].val == format)
					return BarcodeInfo[index].desc;
			}

			return "UNKNOWN";
		}

		function GetErrorInfo(errorcode, errorstring) { //This is the function called when barcode reading fails
			document.getElementById('divNoteMessage').innerHTML = errorstring;
		}

		function ReadBarcode() {
			if (DWObject) {
				if (DWObject.HowManyImagesInBuffer == 0) {
					document.getElementById('divNoteMessage').innerHTML = "Please scan or load an image first.";
					return;
				}

				var index = DWObject.CurrentImageIndexInBuffer;
				var readerMode = "balance";
				for (var i = 0; i < 3; i++) {
				    var vReaderMode = document.getElementsByName("ReaderMode").item(i);
				    if (vReaderMode.checked == true) {
				        readerMode = vReaderMode.value;
				        break;
				    }
				}

				DWObject.Addon.BarcodeReader.getRuntimeSettings(readerMode).then(function (settings) {
				    if (DWObject.GetImageBitDepth(index) == 1)
				        settings.scaleDownThreshold = 214748347;
				    else
				        settings.scaleDownThreshold = 2300;
				    var ddlBarcodeInfo = BarcodeInfo[document.getElementById("barcodeformat").selectedIndex];
				    if (ddlBarcodeInfo.bf == 2) {
				        settings.barcodeFormatIds = 0;
				        settings.barcodeFormatIds_2 = ddlBarcodeInfo.val;
				    }
				    else {
				        settings.barcodeFormatIds = ddlBarcodeInfo.val;
				        if (ddlBarcodeInfo.val == BarcodeInfo[0].val) {
				            settings.barcodeFormatIds_2 = 32505858; //POSTALCODE(32505856) + DOTCODE(2)
				        } else
				            settings.barcodeFormatIds_2 = 0;
				    }
				    settings.expectedBarcodesCount = 512;

				    DWObject.Addon.BarcodeReader.updateRuntimeSettings(settings).then(function () {

				        DWObject.Addon.BarcodeReader.decode(index).then(function (results) { //This is the function called when barcode is read successfully
				            //Retrieve barcode details
				            if (results.length == 0) {
				                document.getElementById('divNoteMessage').innerHTML = "The barcode for the selected format is not found.";
				                return;
				            } else {
				                barcodeText = [];
				                for (i = 0; i < results.length; i++) {
				                    var result = results[i];
				                    Barcode_text = result.barcodeText;
				                    var loc = result.localizationResult;
				                    var x = loc.x1;
				                    var y = loc.y1;
				                    var format = result.barcodeFormatString;
				                    if (result.barcodeFormat == 0)
				                        format = result.barcodeFormatString_2;
				                    barcodeText.push("barcode[" + (i + 1) + "]: " + "<br /><strong>" + Barcode_text + "</strong><br />");
				                    barcodeText.push("format:" + format + "<br />");
				                    barcodeText.push("x:" + x + " y:" + y + "<br />");
				                    barcodeText.push("------------------------------<br />");
				                }

				                barcodeText.splice(0, 0, '<p style="padding:5px; margin:0;">');
				                barcodeText.push('</p>');
				                document.getElementById('divNoteMessage').innerHTML = barcodeText.join('');
				            }
				        }, function (ex) { //This is the function called when barcode reading fails
				            document.getElementById('divNoteMessage').innerHTML = ex.message || ex;
				        });
				    });
				});
			}
		}
	</script>
</body>

</html>